<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Sales Bill</title>
    <link rel="stylesheet" href="../css/bill.css"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Courier+New" type="text/css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">

</head>
<body style="background-color:whitesmoke;">
    <div class='card mx-auto rounded' style="width: 75%; height:100%; text-align:center; margin:30px; padding:20px; box-shadow: 1em 0em 1em 0.5em #ccc">

        <div class='row'>
            <div class="col" style="text-align: center;"> <h4 style="font-weight:bold;">GST Invoice</h4></div>
        </div>

        <div class='row align-items-end' style="margin-bottom: 0em;" >
            
            <div class="col float-left">
                <p class="float-left" style="margin-left: 50px; font-weight:bold; text-align:left; font-family:Courier New; font-size:22px;">
                    Champion Distributors<br/>
                    VIII/73, KALLUKKUDY,<br/>
                    KODANAD P.O,<br/>
                    ERNAKULAM - 683544<br/>
                    Phone: 9447226455
                </p>
            </div>
            
            <div class="col float-right" >
                <p class="float-right" style=" text-align:left; font-weight:bold; margin-right: 50px; font-family:Courier New; font-size:22px;">
                    GSTIN : 32BCCPR5741N12B<br/>
                    DL No1: KL-EKM-117304-20B<br/>
                    DL No2: KL-EKM-117305-21B
                </p>
            </div>
           
        </div>

        <hr style="border-top: 2px dashed #999;">
        
        <div class='row'>
            <div class="col" style="text-align: center;"> <p style="font-weight: bold; font-size: 20px;">CREDIT</p></div>
        </div>
        
        <div class="row" style="margin-bottom:0px">
            <div class="col float-left" style="margin-left: 50px; text-align:left;" >
                <div class="row">
                    <div class="col-1 float-left" style="text-align: left; width:fit-content">
                        <h5 style="margin-top: 20px; margin-right:0px; width:fit-content ">Doctor</h5>
                        <h5 style="margin-top: 20px; margin-right:0px; width:fit-content">Address</h5>
                    </div>
                    <div class="col float-left" style="margin-left: 70px;">
                        <h5 id="doctorName" style="margin-top:20px; margin-bottom:3px; width:fit-content;"></h5><br/>
                        <h5 id="doctorAddress" style="margin-top: 0px; margin-right:0px; width:fit-content"></h5>
                    </div>
                </div>
            </div>
                
            <div class="col float-right" style="margin-left:50px;">
                <div class="row" style="padding-left:25%">
                    <div class="col-1 float-left" style="text-align: left; width:fit-content">
                        <h5 style="margin-top: 20px; margin-right:0px; width:fit-content ">INVOICE</h5>
                        <h5 style="margin-top: 20px; margin-right:0px; width:fit-content">DATE</h5>
                        <h5 style="margin-top: 20px; margin-right:0px; width:fit-content">PAGE</h5>
                    </div>
                    <div class="col float-right" style="margin-left: 70px; text-align:left">
                        <h5 id="invoice_number" style="margin-top: 20px; width: fit-content; text-align:left; margin-bottom:0px;"><br/>
                        <h5 id="dateField" style="margin-top: 20px; margin-right:0px; width:fit-content"></h5>
                        <h5 style="margin-top: 20px; margin-right:0px; width:fit-content">1</h5>
                    </div>
                </div>
                
            </div>
        </div>

        <div class="row" style="margin-bottom: 10px; margin-top:0px">
            <div class="col" style="text-align: left; margin-left:50px">
                <h4 style="font-weight:bold; font-family:Courier New;">
                    GST IN No : 32BCCPR5741N12B  DL No: KL-EKM-115546, KL-EKM-115546/2016
                </h4>
            </div>
        </div>

        <hr style="border-top: 2px dashed #999; margin-top:0;">

        <div class="row">
            <table id="billTable" class="table table-striped">
                <thead>
                    <tr>
                        <th scope="col">MFR</th>
                        <th scope="col">NAME</th>
                        <th scope="col">PACK</th>
                        <th scope="col">HSN</th>
                        <th scope="col">BATCH</th>
                        <th scope="col">EXP</th>
                        <th scope="col">QTY</th>
                        <th scope="col">FREE</th>
                        <th scope="col">RATE</th>
                        <th scope="col">MRP</th>
                        <th scope="col">CGST</th>
                        <th scope="col">SGST</th>
                        <th scope="col">AMNT</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    
                </tbody>   
            </table>
        </div>

        <hr style="border-top: 2px dashed #999; margin-top:0;">

    
        <div class="row" style="margin-bottom: 0;">
            <div class="col float-left" style="margin-left: 50px;" >
                <p id="itemsAndQty" style="text-align: left; font-size:22px;">
                    TOTAL ITEMS : <br/>
                    TOTAL QTY : <br/>
                </p>
            </div>
                
            <div class="col float-right" style="text-align: left; margin-left:400px">
                <p style="font-size:22px; margin-bottom:0px;">
                    CR/DR AMNT: 0.00<br/>
                    CR/DR Add<br/>
                    CHARGES   : 0.00 
                </p>
                <div>
                    <p id="discount" class="float-left" style="margin-top:10px; margin-right:0px; font-size:22px;"> DISCOUNT :</p>
                    
                </div>
            </div>

            <div class="col float-right" style="text-align: left;">
                <p id="totals" style="text-align:left; margin-bottom:0px; font-size:22px">
                    SUB TOTAL : <br/>
                    TOTAL SGST : <br/>
                    TOTAL CGST : 
                </p>
                <div>
                    <p id="roundOff" class="float-left" style="margin-top:10px; margin-right:0px; font-size:22px;">ROUND OFF :</p>
                    
                </div>
            </div>
        </div>

        
        <hr style="border-top: 2px dashed #999; margin-top:0;">

        <div class='row align-items-end' style="margin-bottom: 0em;" >
            
            <div class="col float-left">
                <p id="kfcess" class="float-left" style="margin-left: 50px; text-align:left; font-size:22px;">
                    KF.CESS 1% : 
                </p>
            </div>
            
            <div class="col float-right" >
                <p class="float-left" style="width:fit-content; margin-right: 25px; text-align:left; font-weight:bold; font-size:22px;">
                    BILL AMOUNT : 
                </p>
                <p id="finalAmount" class="float-left" style="margin-left:0px; font-weight:bold; font-size:22px;">
                    0.00
                </p>
            </div>
           
        </div>

        <div class="row">
            <div class="col float-left">
                <p id="finalAmountInWords" style="text-align: left; margin-left:50px; font-weight:bold; font-family:Courier New; font-size:22px;">
                Rs.
                </p>
            </div>
        </div>
        
        <hr style="border-top: 2px dashed #999; margin-top:0;">

        <div class='row align-items-end' style="margin-bottom: 0em;" >
            
            <div class="col float-left">
                <p class="float-left" style="margin-left: 50px; text-align:left; font-size:22px;">
                    E & O E<br/>
                    Subject to PERUMBAVOOR Jurisdriction,<br/>
                    Software: https://github.com/fillerink/champion<br/>
                </p>
            </div>
            
            <div class="col float-right" style="text-align: center; font-size:22px;">
                <p>
                    For CHAMPION DISTRIBUTORS<br/>
                     <br/>
                    Authorised Signatory
                </p>
            </div>
           
        </div>


    </div>

    <div class='card mx-auto rounded' style="width: 75%; height:140px; text-align:center; margin:30px; box-shadow: 1em 0em 1em 0.5em #ccc">
        <div class="card-header" style=" text-align:left; background-color:rgb(199, 199, 199);">
            <h4 style="font-weight: bold;">Options</h4>
        </div>
        <button id="createBillButton" class='btn waves-effect waves-light mr-auto' style="margin-top:20px; margin-left:30px; background-color: rgb(0, 0, 126); color:white; font-weight:bold; margin-right:55px;" type="submit">Create New Bill!</button>
    </div>

    <script>
        const path = require('path');
        const electron = require('electron');
        const {app,BrowserWindow} = electron;
        const model = require(path.join(__dirname,'../model.js'));
        window.$ = window.jQuery = require('jquery')

        var ipcRenderer = require('electron').ipcRenderer;

        var data = ipcRenderer.sendSync('send-bill', '');
        console.log(data);
        const billid = data[0];
        const rowStart = data[1];
        const rowEnd = data[2];

        const billList = model.getSalesBills(path.join(__dirname,"../../database/"));
        var currentBill = null;
        for(const i in billList){
            if(billid==billList[i].bill_id){
                currentBill = billList[i];
                break;
            }
          }

        console.log(currentBill);

        const doctorName = document.getElementById('doctorName');
        doctorName.innerHTML = currentBill.doctor;

        const doctorAddress = document.getElementById('doctorAddress');

        doctorList = model.getDoctors(path.join(__dirname,"../../database/"));
        for(const i in doctorList){
            if(currentBill.doctor===doctorList[i].name){
                doctorAddress.innerHTML = doctorList[i].address;
                break;
            }
        }

        const invoice_number = document.getElementById('invoice_number');
        invoice_number.innerHTML = currentBill.bill_id;

        const dateField = document.getElementById('dateField');
        dateField.innerHTML = currentBill.date;

        const rows = model.getSalesBillRows(path.join(__dirname,"../../database/"));
        console.log(rows);

        var billTable = document.getElementById('billTable').getElementsByTagName('tbody')[0];

        
        for(var i =currentBill.billRowStarting-1; i<currentBill.billRowEnding-1; i++){
                    
                    var newRow   = billTable.insertRow();
                    
                    var mfrCell  = newRow.insertCell(0);
                    var mfrText  = document.createTextNode(rows[i].MFR);
                    mfrCell.appendChild(mfrText);
                    mfrCell.className = "bill-row-item";

                    var nameCell  = newRow.insertCell(1);
                    var nameText  = document.createTextNode(rows[i].NAME);
                    nameCell.appendChild(nameText);
                    nameCell.className = "bill-row-item";
                    //pack hsn batch exp qty free rate mrp cgst sgst amnt
                    var packCell  = newRow.insertCell(2);
                    var packText  = document.createTextNode(rows[i].PACK);
                    packCell.appendChild(packText);
                    packCell.className = "bill-row-item";

                    var hsnCell  = newRow.insertCell(3);
                    //var hsnText  = document.createTextNode(medicineList[i].manufacturer);
                    var hsnText  = document.createTextNode(rows[i].HSN);
                    hsnCell.appendChild(hsnText);
                    hsnCell.className = "bill-row-item";
                    
                    var batchCell  = newRow.insertCell(4);
                    var batchText  = document.createTextNode(rows[i].BATCH);
                    batchCell.appendChild(batchText);
                    batchCell.className = "bill-row-item";

                    var expCell  = newRow.insertCell(5);
                    var expText  = document.createTextNode(rows[i].EXP);
                    expCell.appendChild(expText);
                    expCell.className = "bill-row-item";

                    var qtyCell  = newRow.insertCell(6);
                    var qtyText  = document.createTextNode(rows[i].QTY);
                    qtyCell.appendChild(qtyText);
                    qtyCell.className = "bill-row-item";

                    var freeCell  = newRow.insertCell(7);
                    var freeText  = document.createTextNode(rows[i].FREE);
                    freeCell.appendChild(freeText);
                    freeCell.className = "bill-row-item";

                    var rateCell  = newRow.insertCell(8);
                    var rateText  = document.createTextNode(rows[i].RATE);
                    rateCell.appendChild(rateText);
                    rateCell.className = "bill-row-item";

                    var mrpCell  = newRow.insertCell(9);
                    var mrpText  = document.createTextNode(rows[i].MRP);
                    mrpCell.appendChild(mrpText);
                    mrpCell.className = "bill-row-item";

                    var cgstCell  = newRow.insertCell(10);
                    var cgstText  = document.createTextNode(rows[i].CGST);
                    cgstCell.appendChild(cgstText);
                    cgstCell.className = "bill-row-item";

                    var sgstCell  = newRow.insertCell(11);
                    var sgstText  = document.createTextNode(rows[i].SGST);
                    sgstCell.appendChild(sgstText);
                    sgstCell.className = "bill-row-item";

                    var amountCell  = newRow.insertCell(12);
                    var amountText  = document.createTextNode(rows[i].AMNT);
                    amountCell.appendChild(amountText);
                    amountCell.className = "bill-row-item";
        }

        const itemsAndQty = document.getElementById('itemsAndQty');
        itemsAndQty.innerHTML = `TOTAL ITEMS : ${currentBill.totalItems}<br/>
        TOTAL QTY : ${currentBill.totalQuantity}<br/>`;
        
        const discount = document.getElementById('discount');
        discount.innerHTML = `DISCOUNT : ${currentBill.discount}`;

        const totals = document.getElementById('totals');
        totals.innerHTML = `SUB TOTAL : ${currentBill.subtotal} <br/>
        TOTAL SGST : ${currentBill.totalSgst}<br/>
        TOTAL CGST : ${currentBill.totalCgst}`;
        
        const roundOff = document.getElementById('roundOff');
        roundOff.innerHTML = `ROUNDOFF : ${currentBill.roundoff}`;

        const kfcess = document.getElementById('kfcess');
        kfcess.innerHTML =  `KF.CESS 1% : ${currentBill.kfcess}`;
        
        const billAmount = document.getElementById('finalAmount');
        billAmount.innerHTML = currentBill.billAmount;

        var a = ['','One ','Two ','Three ','Four ', 'Five ','Six ','Seven ','Eight ','Nine ','Ten ','Eleven ','Twelve ','Thirteen ','Fourteen ','Fifteen ','Sixteen ','Seventeen ','Eighteen ','Nineteen '];
        var b = ['', '', 'Twenty','Thirty','Forty','Fifty', 'Sixty','Seventy','Eighty','Ninety'];

        function inWords (num) {
            if ((num = num.toString()).length > 9) return 'overflow';
            n = ('000000000' + num).substr(-9).match(/^(\d{2})(\d{2})(\d{2})(\d{1})(\d{2})$/);
            if (!n) return; var str = '';
            str += (n[1] != 0) ? (a[Number(n[1])] || b[n[1][0]] + ' ' + a[n[1][1]]) + 'Crore ' : '';
            str += (n[2] != 0) ? (a[Number(n[2])] || b[n[2][0]] + ' ' + a[n[2][1]]) + 'Lakh ' : '';
            str += (n[3] != 0) ? (a[Number(n[3])] || b[n[3][0]] + ' ' + a[n[3][1]]) + 'Thousand ' : '';
            str += (n[4] != 0) ? (a[Number(n[4])] || b[n[4][0]] + ' ' + a[n[4][1]]) + 'Hundred ' : '';
            str += (n[5] != 0) ? ((str != '') ? 'and ' : '') + (a[Number(n[5])] || b[n[5][0]] + ' ' + a[n[5][1]]) : '';
            str += 'Only'; 
            return str;
        }

        const billAmountWords = document.getElementById('finalAmountInWords');
        //console.log(parseFloat(currentBill.billAmount));
        
        billAmountWords.innerHTML = inWords(parseFloat(currentBill.billAmount));

        

    </script>
</body>
</html>